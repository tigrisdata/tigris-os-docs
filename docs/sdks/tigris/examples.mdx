import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Examples

If you want to see it the Storage SDK used with your tool of choice, we have
some ready examples available at
[our community repo](https://github.com/tigrisdata-community/storage-sdk-examples).
Something missing there that you you'd like to see? Let us know and we'll be
more than happy to add in examples.

## Viewing and downloading files

`get` function can be used to get a file from a bucket. `contentDisposition`
option can be to either `attachment` or `inline` depending on whether you want
to trigger a download or display the file in the browser.

<Tabs>
<TabItem value="server" label="Server" default>

```ts
// app/api/avatar/route.ts
import { NextRequest, NextResponse } from "next/server";
import { get } from "@tigrisdata/storage";

export async function GET(
  req: NextRequest,
): Promise<NextResponse<File | string>> {
  const avatar = req.nextUrl.searchParams.get("avatar");

  if (!avatar) {
    return NextResponse.json("avatar parameter is required", { status: 400 });
  }

  try {
    const avatarPath = decodeURIComponent(avatar as string);

    const file = await get(avatarPath, "file", {
      contentDisposition: "inline",
    });

    if (file.data) {
      return new NextResponse(file.data, { status: 200 });
    }

    if (file.error && file.error.message) {
      return NextResponse.json(file.error.message, { status: 500 });
    }
  } catch (error) {
    return NextResponse.json(
      error instanceof Error ? error.message : "Unknown error",
      { status: 500 },
    );
  }

  return NextResponse.json("No data found", { status: 404 });
}
```

</TabItem>
<TabItem value="client" label="Client">

```tsx
import Image from "next/image";

export default function Avatar() {
  const { user } = getUserData();

  return (
    <Image
      src={`/api/avatar?avatar=${encodeURIComponent(user.avatar)}`}
      alt="Avatar"
      width={100}
      height={100}
    />
  );
}
```

</TabItem>
</Tabs>

To trigger a download, set the `contentDisposition` option to `attachment`.

## Uploading files

`put` function can be used to upload a file to a bucket.

<Tabs>
<TabItem value="server" label="Server" default>

```ts
// app/api/upload/route.ts
import { NextRequest, NextResponse } from "next/server";
import { put } from "@tigrisdata/storage";

export async function PUT(req: NextRequest) {
  const formData = await req.formData();
  const file = formData.get("file") as File;

  if (!file) {
    return NextResponse.json({ error: "No file provided" }, { status: 400 });
  }

  const result = await put(file.name, file, {
    access: "public",
    addRandomSuffix: false,
  });

  if (result.error) {
    return NextResponse.json({ error: result.error.message }, { status: 500 });
  }

  return NextResponse.json({ data: result.data }, { status: 200 });
}
```

</TabItem>
<TabItem value="client" label="Client">

```tsx
export default function Upload() {
  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];

    if (file) {
      const formData = new FormData();
      formData.append("file", file);
      fetch("/api/test", {
        method: "PUT",
        body: formData,
      });
    }
  };

  return <input type="file" onChange={handleFileChange} />;
}
```

</TabItem>
</Tabs>

## Client Uploads

Tigris does not charge egress fees, but your hosting provider may charge them
for user uploads to Tigris. We care about your bandwidth costs, so we made it
easy to have the server and client work together to upload things. This lets you
give a presigned URL to the client and then have the client upload to Tigris
instead of your server needing to be in the middle.

We leverage the
[presigned URLs](/docs/sdks/tigris/using-sdk#presigning-an-object) features to
allow you to upload files directly to Tigris from the client side.

<Tabs>  
<TabItem value="server" label="Server" default>

```ts
// app/api/upload/route.ts
import { NextRequest, NextResponse } from "next/server";
import { handleClientUpload } from "@tigrisdata/storage";

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { data, error } = await handleClientUpload(body);

    if (error) {
      return NextResponse.json({ error: error.message }, { status: 500 });
    }

    return NextResponse.json({ data });
  } catch (error) {
    return NextResponse.json(
      { error: "Failed to process upload request" },
      { status: 500 },
    );
  }
}
```

</TabItem>

<TabItem value="client" label="Client">

```tsx
"use client";

import { upload } from "@tigrisdata/storage/client";
import { useState } from "react";

export default function ClientUpload() {
  const [progress, setProgress] = useState<number>(0);
  const [url, setUrl] = useState<string | null>(null);
  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    setProgress(0);
    if (file) {
      const result = await upload(`${file.name}`, file, {
        url: "/api/upload",
        access: "private",
        multipart: true,
        partSize: 10 * 1024 * 1024, // 10 MiB parts
        onUploadProgress: ({ loaded, total, percentage }) => {
          setProgress(percentage);
          if (percentage === 100) {
            setProgress(0);
          }
        },
      });
      setUrl(result.url);
    }
  };

  return (
    <>
      <input type="file" onChange={handleFileChange} />{" "}
      {url && <div>Uploaded to: {url}</div>}{" "}
      {progress > 0 && progress < 100 && <div>{progress}%</div>}{" "}
    </>
  );
}
```

</TabItem>

</Tabs>

## React Package

Alternatively, you can use the `Uploader` component from the `@tigrisdata/react`
package to render a file uploader component that integrates with the Tigris
Storage SDK.

```tsx
import { Uploader } from "@tigrisdata/react";
import "@tigrisdata/react/styles.css"; // Optional: import default styles

export default function ClientUpload() {
  return (
    <div className="bg-white shadow rounded-lg p-6 mb-6">
      <h2 className="text-lg font-medium text-gray-900 mb-2">Client Uploads</h2>
      <Uploader
        className="mt-4 tigris-uploader"
        accept="image/*"
        multiple={true}
        multipart={true}
        concurrency={3}
        url="/api/upload"
        onUploadComplete={(file, response) => {
          console.log("Uploaded:", response.url);
        }}
        onUploadError={(file, error) => {
          console.error("Failed:", error.message);
        }}
      />
    </div>
  );
}
```
